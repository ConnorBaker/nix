# shellcheck shell=bash
set -euo pipefail

testcaseBasename=$1

# Normalize the duplicate frames count (varies by machine stack size and memory layout)
# Remove everything after the duplicate frames message - the trailing frames vary by stack size
sed -i "$testcaseBasename.err" \
  -e 's/([0-9][0-9]* duplicate frames omitted)/(<N> duplicate frames omitted)/g' \
  -e '/(<N> duplicate frames omitted)/,$d' \
;

# Add back just the normalized duplicate frames line and stack overflow error
echo "       (<N> duplicate frames omitted)

       error: stack overflow; max-call-depth exceeded" >> "$testcaseBasename.err"
